---
title: "Following protocol for flowSOM implementation"
output: html_notebook
---

NOTE: *R version 4.5.0*. Also make sure [Rtools45](https://cran.r-project.org/bin/windows/Rtools/rtools45/rtools.html) is downloaded.

## STEP 1: DOWNLOADING PACKAGES

Navigate towards Tools \> Install Packages and download the following packages:

1.  *ggplot2*
2.  *ggpubr*
3.  *pheatmap*
4.  *tidyr*
5.  *devtools*

Then go on to download *BioConductor* in the following way in order to download *FlowCore* correctly.

```{r}
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

#The following initializes usage of Bioc devel
BiocManager::install(version='devel')
BiocManager::install("flowCore", force = TRUE)
BiocManager::install("flowAI")

#use devtools to download packages from github
devtools::install_github("saeyslab/PeacoQC", force=TRUE)
devtools::install_github("saeyslab/FlowSOM")
```

```{r}
library('flowCore') 
library('FlowSOM') 
library('ggplot2')
library('flowAI')
```

First we read the file as a flowFrame

```{r}
fcs1 <- read.FCS("D:/Internship/Tube_002_Broekk vd 070853_250204 Broek vd 070853_20250204_174358.fcs",
                 transformation=FALSE, truncate_max_range = FALSE)
colnames <- colnames(fcs1)
reference_marker <- "PE-A" # Scatter values will be scaled to have the same range
markers_of_interest <- 
```

```{r}
qc_result <- flow_auto_qc(fcs1, output = 1, folder_results = 'C:/Users/20192032/OneDrive - TU Eindhoven/Documents/GitHub/Internship', html_report = TRUE)

cleaned_fcs <- qc_result$flowFrame
```

```{r}
summary(fcs1)
```

```{c("SSC-A", "FITC-A", "PE-A", "PerCP-Cy5.5-A", "PE-Cy7-A", "APC-A", "APC-R700-A")}
```

Here we perform the removal of margin events and also the compensation is done. - Compensation is done to correct for spillover - removal of margin events, because these

```{r}
channels_of_interest <- GetChannels(object = fcs1, markers = markers_of_interest, exact = FALSE)

ff_m <- PeacoQC::RemoveMargins(fcs1, markers_of_interest)
ff_c <- compensate(ff_m, spillover(fcs1)$`$SPILLOVER`) #spillover(fcs1) extracts the spillover matrix from the metadata of the file.
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
